<?php
/**
 * Определение номера гексаграммы по 6 линиям (King Wen sequence).
 * Источник: Wikibooks I Ching/The 64 Hexagrams
 * yang=1, yin=0, линии снизу вверх (1–6)
 */
class Iching
{
    /** Таблица King Wen: бинарная строка (снизу вверх) => номер 1–64 */
    private static $BINARY_TO_NUMBER = array(
        '111111' => 1,  '000000' => 2,  '010001' => 3,  '100010' => 4,
        '010111' => 5,  '111010' => 6,  '000010' => 7,  '010000' => 8,
        '110111' => 9,  '111011' => 10, '000111' => 11, '111000' => 12,
        '111101' => 13, '101111' => 14, '000100' => 15, '001000' => 16,
        '011001' => 17, '100110' => 18, '000011' => 19, '110000' => 20,
        '101001' => 21, '100101' => 22, '100000' => 23, '000001' => 24,
        '111001' => 25, '100111' => 26, '100001' => 27, '011110' => 28,
        '010010' => 29, '101101' => 30, '011100' => 31, '001110' => 32,
        '111100' => 33, '001111' => 34, '101000' => 35, '000101' => 36,
        '110101' => 37, '101011' => 38, '010100' => 39, '001010' => 40,
        '100011' => 41, '110001' => 42, '011111' => 43, '111110' => 44,
        '011000' => 45, '000110' => 46, '011010' => 47, '010110' => 48,
        '011101' => 49, '101110' => 50, '001001' => 51, '100100' => 52,
        '110100' => 53, '001011' => 54, '001101' => 55, '101100' => 56,
        '110110' => 57, '011011' => 58, '110010' => 59, '010011' => 60,
        '110011' => 61, '001100' => 62, '010101' => 63, '101010' => 64,
    );

    /**
     * Определяет номер гексаграммы (1–64) по массиву линий.
     * @param array $lines Массив ["yang"|"yin"] от линии 1 (нижней) до 6 (верхней)
     * @return int Номер 1–64 или 0 при ошибке
     */
    public static function hexagramNumber(array $lines)
    {
        if (count($lines) !== 6) {
            return 0;
        }
        $binary = '';
        foreach ($lines as $line) {
            $binary .= ($line === 'yang') ? '1' : '0';
        }
        // Wikibooks: первая цифра = верхняя линия. Мы считаем снизу — реверс для lookup.
        $binaryReversed = strrev($binary);
        return isset(self::$BINARY_TO_NUMBER[$binaryReversed]) ? self::$BINARY_TO_NUMBER[$binaryReversed] : 0;
    }
}
